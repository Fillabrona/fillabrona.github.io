<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz for Survival - Latest Download & Info</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/Xxrtbmmp/cropped-circle-image-3.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.1/dist/dotlottie-wc.js" type="module"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-bg': '#2b333e',
                        'link-primary': '#02d8e9',
                        'button-primary': '#00A1A1',
                        'card-bg': '#374151',
                    },
                    fontFamily: {
                        'serif': ['"Times New Roman"', 'Times', 'serif'],
                    }
                }
            }
        }
    </script>
<style>
    body {
        background-color: #2b333e;
        font-family: 'Times New Roman', Times, serif;
        color: white;
        transition: background-color 0.3s;
    }
    body::-webkit-scrollbar {
        width: 8px;
    }
    body::-webkit-scrollbar-thumb {
        background-color: #00A1A1;
        border-radius: 4px;
    }
    .card-glow:hover {
        box-shadow: 0 0 15px rgba(2, 216, 233, 0.15);
    }
    .hero-section {
        position: relative;
        overflow: hidden;
    }
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        /* Using a placeholder image */
        background-image: url('https://i.ibb.co/S4XB6n0v/Site-background-light-1-1.png');
        background-size: cover;
        background-position: center 22%;
        filter: blur(1px);
        transform: scale(1);
        z-index: -2;
    }
    .hero-section::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, rgba(43, 51, 62, 0.7) 0%, #2b333e 85%);
        z-index: -1;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .content-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }
</style>
</head>
<body class="min-h-screen p-4 sm:p-8 font-serif">

    <!-- Modal Backdrop - Hidden by default -->
    <div id="download-modal-backdrop" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none">
        <!-- Modal Content -->
        <div id="download-modal-content" class="bg-card-bg p-6 sm:p-8 rounded-2xl shadow-2xl max-w-sm w-11/12 transform scale-90 transition-all duration-300 relative border-2 border-link-primary/50">

            <!-- Close Button -->
            <button id="modal-close-button" class="absolute top-3 right-3 text-white/50 hover:text-white transition duration-200">
                <i class="fas fa-times-circle text-2xl"></i>
            </button>

            <div class="flex flex-col items-center text-center space-y-4">
                <dotlottie-wc
                    src="https://lottie.host/be23f1e0-b091-46b7-8a08-ae79a6f4bb51/KAzxaEOB4s.lottie"
                    style="width: 300px;"
                    autoplay loop>
                </dotlottie-wc>

                <h3 class="text-3xl font-bold text-link-primary">Download Initiated!</h3>
                <p id="modal-message" class="text-white/80 text-lg">
                    The automatic download is starting now. Check your browser's download folder.
                </p>

                <button onclick="document.getElementById('modal-close-button').click()"
                    class="mt-4 w-full px-6 py-3 text-lg font-semibold text-main-bg bg-button-primary rounded-xl transition duration-300 hover:bg-opacity-80 active:scale-95">
                    <i class="fas fa-thumbs-up mr-2"></i> Got It
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-10">

        <header class="text-center py-12 hero-section rounded-t-2xl">
            <h1 class="text-5xl sm:text-7xl font-bold tracking-tighter text-link-primary mb-3 drop-shadow-lg">
                Quiz for Survival
            </h1>
            <p class="text-xl text-white/70 font-light">The latest official release and future development roadmap.</p>
        </header>

        <!-- NEW: About the Game Section -->
        <div class="bg-card-bg border border-white/10 p-6 sm:p-10 rounded-2xl shadow-xl space-y-4 transition duration-500 hover:scale-[1.01] card-glow">
            <h2 class="text-3xl font-bold text-link-primary border-b-4 border-link-primary/50 pb-3 flex items-center">
                <i class="fas fa-book-open mr-3 text-2xl"></i> About the Game
            </h2>
            <p class="text-white/90 text-lg leading-relaxed">
                Quiz for Survival is an intense trivia experience that challenges your knowledge, strategy, and risk management with over 2,500 questions across categories like General Knowledge, Sports, History, Games, Geography, Language, Music, Math, and Measurements. Each round features 10 randomly selected questions with four answer choices, but only one is correct, keeping every playthrough unpredictable. Correct answers award 10 points and 5 coins, while wrong answers reduce health by 10 and cost 3 coins, adding tension and strategy to every decision. After each round, the shop opens, letting you spend coins on Health Potions, Extra Lives, Mystery Boxes, Lucky Triples, and more, to enhance your survival chances. With four gameplay modes, Normal, Gauntlet, Shopless, and Multiplayer, and five difficulty levels Unlimited, Easy, Hard, Extreme, and Unbeatable, players can tailor the challenge to their skill. The game also features 15 achievements, a top-30 leaderboard, and an in-game feedback system for feedback & suggestions. When you reach the target score, a victory screen summarizes your performance, including final score, coins, health, completion time, correct and wrong answers, and a performance rating out of 100, giving a clear picture of how well you did. Combining knowledge, risk, and strategy, Quiz for Survival is an addictive, fast-paced trivia game that tests both your skill and endurance, rewarding careful play and quick thinking alike.
            </p>
        </div>
        <!-- END NEW Section -->

        <div id="latest-version-card" class="bg-card-bg border border-white/10 p-6 sm:p-10 rounded-2xl shadow-xl space-y-8 transition duration-500 hover:scale-[1.01] card-glow">

            <div id="latest-version-meta" class="text-center space-y-2 mb-6"></div>

            <h2 id="latest-version-heading" class="text-3xl font-bold text-link-primary border-b-4 border-link-primary/50 pb-3 mb-4 flex items-center">
                <i class="fas fa-spinner fa-spin mr-3 text-2xl"></i> Loading Update Info...
            </h2>

            <div id="latest-version-content">
                <div id="version-placeholder" class="space-y-4 animate-pulse">
                    <div class="h-5 bg-gray-600 rounded w-1/4"></div>
                    <div class="space-y-2 pl-6">
                        <div class="h-4 bg-gray-700 rounded w-full"></div>
                        <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                    </div>
                    <div class="h-5 bg-gray-600 rounded w-1/3 pt-4"></div>
                    <div class="space-y-2 pl-6">
                        <div class="h-4 bg-gray-700 rounded w-full"></div>
                    </div>
                </div>
            </div>

            <div class="pt-6 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                <button id="download-button"
                    class="w-full sm:w-auto px-10 py-4 text-lg font-bold text-white uppercase transition duration-300 transform bg-button-primary rounded-xl shadow-2xl shadow-button-primary/50 hover:shadow-button-primary/80 hover:bg-opacity-90 active:scale-95 disabled:opacity-50">
                    <i class="fas fa-cog fa-spin mr-2"></i> Initializing...
                </button>

                <a href="https://docs.google.com/document/d/11sxU4b9yxqJY74rFXaz1YaIQF85cnPe7SX3nzGZJ7Zk/edit?tab=t.0" target="_blank"
                    class="w-full sm:w-auto px-6 py-4 text-center text-link-primary hover:text-white transition duration-300 border border-link-primary rounded-xl hover:bg-link-primary/20">
                    <i class="fas fa-scroll mr-2"></i> View Full Change Log
                </a>
            </div>
        </div>

        <div class="bg-card-bg border border-white/10 p-6 sm:p-10 rounded-2xl shadow-xl space-y-8 transition duration-500 hover:scale-[1.01] card-glow">
            <h2 class="text-3xl font-bold text-link-primary border-b-4 border-link-primary/50 pb-3 mb-4 flex items-center">
                <i class="fas fa-rocket mr-3 text-2xl"></i> Upcoming Features
            </h2>
            <div id="whats-next-content">
                <div id="roadmap-placeholder" class="space-y-4 animate-pulse">
                     <div class="h-5 bg-gray-600 rounded w-1/4"></div>
                    <div class="space-y-2 pl-6">
                        <div class="h-4 bg-gray-700 rounded w-full"></div>
                        <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const URLS = {
                masterData: 'https://gist.githubusercontent.com/Fillabrona/5a17fe172177f74a4a65196ba1b53c50/raw/6ef3af477c4c041bdf661f5b50b8de90cbfbfd88/downloadinfo'
            };

            const SELECTORS = {
                latestVersionHeading: document.getElementById('latest-version-heading'),
                downloadButton: document.getElementById('download-button'),
                versionContentDiv: document.getElementById('latest-version-content'),
                versionMetaDiv: document.getElementById('latest-version-meta'),
                whatsNextDiv: document.getElementById('whats-next-content'),
                // New Modal Selectors
                modalBackdrop: document.getElementById('download-modal-backdrop'),
                modalContent: document.getElementById('download-modal-content'),
                modalCloseButton: document.getElementById('modal-close-button'),
                modalMessage: document.getElementById('modal-message'),
            };

            const defaultButtonText = '<i class="fas fa-download mr-2"></i> Download Latest Version';

            const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            // --- Modal Functions ---
            const showDownloadModal = (versionNumber) => {
                SELECTORS.modalMessage.innerHTML = `The automatic download for version <b>${versionNumber}</b> is starting now. Check your browser's download folder.`;
                SELECTORS.modalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
                SELECTORS.modalContent.classList.remove('scale-90');

                // Set click outside to close (optional, but good UX)
                SELECTORS.modalBackdrop.onclick = (e) => {
                    if (e.target.id === 'download-modal-backdrop') {
                        hideDownloadModal();
                    }
                };
            };

            const hideDownloadModal = () => {
                SELECTORS.modalBackdrop.classList.add('opacity-0', 'pointer-events-none');
                SELECTORS.modalContent.classList.add('scale-90');
                SELECTORS.modalBackdrop.onclick = null; // Clean up listener
            };
            // --- End Modal Functions ---


            const formatContentText = (text, style = "feather") => {
                if (!text) return '<p class="text-red-400">Data content is empty.</p>';

                const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                let html = '<ul class="list-none space-y-3 pl-0">';

                lines.forEach(line => {
                    if (line.startsWith('•')) {
                        const content = line.substring(1).trim();
                        if (style === "feather") {
                            html += `<li class="flex items-start text-white/90">
                                <i class="fa-solid fa-feather text-link-primary mt-1 mr-3 flex-shrink-0 text-sm"></i>
                                <span>${content}</span>
                            </li>`;
                        } else if (style === "bullet") {
                            html += `<li class="flex items-start text-white/90">
                                <span class="text-link-primary mt-1 mr-3 flex-shrink-0 text-sm">•</span>
                                <span>${content}</span>
                            </li>`;
                        }
                    } else if (line.endsWith(':')) {
                        html += `<li class="pt-4 pb-1 text-lg font-bold text-button-primary">${line}</li>`;
                    } else if (line.match(/^\d+\./)) {
                        html += `<li class="pt-4 text-lg font-bold text-button-primary">${line}</li>`;
                    } else if (line.length > 0) {
                        html += `<li class="text-white/80 pl-6">${line}</li>`;
                    }
                });

                html += '</ul>';
                return html;
            };

            const handleFetchError = (error) => {
                console.error("Failed to fetch master data:", error);
                const failureMessage = `<p class="text-red-400 text-center p-6"><i class="fas fa-exclamation-triangle mr-2"></i> Failed to load data. Please check the console for more details.</p>`;
                SELECTORS.latestVersionHeading.innerHTML = '<i class="fas fa-times-circle mr-3 text-2xl"></i> Load Error';
                SELECTORS.versionContentDiv.innerHTML = failureMessage;
                SELECTORS.whatsNextDiv.innerHTML = failureMessage;
                SELECTORS.downloadButton.disabled = true;
                SELECTORS.downloadButton.classList.add('opacity-50', 'cursor-not-allowed');
                SELECTORS.downloadButton.innerHTML = '<i class="fas fa-times-circle mr-2"></i> Link Error';
            };

            const fetchMasterData = async (url, retries = 3) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, { cache: "no-store" });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return await response.json();
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed for ${url}.`, error);
                        if (i < retries - 1) await delay(1000 * (2 ** i));
                        else {
                            handleFetchError(error);
                            return null;
                        }
                    }
                }
            };

            const populatePage = (data) => {
                try {
                    const versionMatch = data.versionInfo.match(/Game:.*(v[\d.]+)/);
                    const versionNumber = versionMatch ? versionMatch[1] : 'Unknown';
                    const authorLineMatch = data.versionInfo.match(/Author: (.*?)\s-\s(https:\/\/fillabrona\.itch\.io\/)/);
                    const authorName = authorLineMatch ? authorLineMatch[1] : 'Fillabrona';
                    const authorUrl = authorLineMatch ? authorLineMatch[2] : 'https://fillabrona.itch.io/';

                    SELECTORS.versionMetaDiv.innerHTML = `
                        <p class="text-4xl font-bold text-white">${versionNumber}</p>
                        <p class="text-white/70">Developed by
                            <a href="${authorUrl}" target="_blank" class="text-link-primary hover:text-white transition duration-200 font-bold">${authorName}</a>
                        </p>`;

                    SELECTORS.latestVersionHeading.innerHTML = `<i class="fas fa-tag mr-3 text-2xl"></i> Latest Update (${versionNumber})`;

                    const updateSection = data.versionInfo.substring(data.versionInfo.indexOf('--- LATEST UPDATE ---') + '--- LATEST UPDATE ---'.length).trim();
                    SELECTORS.versionContentDiv.innerHTML = formatContentText(updateSection, "feather");
                    SELECTORS.versionContentDiv.classList.add('content-fade-in');

                    const roadmapSection = data.whatsNext.substring(data.whatsNext.indexOf('--- UPCOMING FEATURES ---') + '--- UPCOMING FEATURES ---'.length).trim();
                    SELECTORS.whatsNextDiv.innerHTML = formatContentText(roadmapSection, "bullet");
                    SELECTORS.whatsNextDiv.classList.add('content-fade-in');

                    if (data.downloadLink) {
                        SELECTORS.downloadButton.setAttribute('data-download-url', data.downloadLink);
                        SELECTORS.downloadButton.disabled = false;
                        SELECTORS.downloadButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        SELECTORS.downloadButton.innerHTML = defaultButtonText;

                        // --- START: Auto-download logic with Modal ---
                        setTimeout(() => {
                            showDownloadModal(versionNumber);

                            const a = document.createElement('a');
                            a.href = data.downloadLink;
                            a.download = '';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        }, 500);
                        // --- END: Auto-download logic with Modal ---
                    } else {
                        throw new Error("Download link not found in data.");
                    }
                } catch (processingError) {
                    console.error("Error processing fetched data:", processingError);
                    handleFetchError(processingError);
                }
            };

            const setupDownloadHandler = () => {
                // Modal Close Listener
                SELECTORS.modalCloseButton.addEventListener('click', hideDownloadModal);

                // Manual Download Click Handler
                SELECTORS.downloadButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const downloadUrl = SELECTORS.downloadButton.getAttribute('data-download-url');

                    if (downloadUrl && !SELECTORS.downloadButton.disabled) {
                        SELECTORS.downloadButton.disabled = true;
                        SELECTORS.downloadButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Starting Download...';

                        setTimeout(() => {
                            // Show modal on manual click too
                            showDownloadModal(SELECTORS.versionMetaDiv.querySelector('p:first-child').textContent);

                            window.location.href = downloadUrl;
                            setTimeout(() => {
                                SELECTORS.downloadButton.disabled = false;
                                SELECTORS.downloadButton.innerHTML = defaultButtonText;
                            }, 1500);
                        }, 500);
                    }
                });
            };

            const initializePage = async () => {
                SELECTORS.downloadButton.disabled = true;
                const data = await fetchMasterData(URLS.masterData);
                if (data) {
                    populatePage(data);
                    setupDownloadHandler();
                }
            };

            initializePage();
        });
    </script>

</body>
</html>
