<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Quiz for Survival - Latest Download & Info</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/Xxrtbmmp/cropped-circle-image-3.png">
    
    <meta name="google-site-verification" content="MVor7wrlMLFwH8xrfTZFunQW4OTHCyqDeN5kt9ujt6E" />
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.1/dist/dotlottie-wc.js" type="module"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Original main-bg
                        'main-bg': '#2b333e',  
                        // Muted Blue Accent: A slightly darker, less neon blue/cyan
                        'link-primary': '#04a4b0',  
                        // Muted Button Teal: A darker, more sophisticated teal
                        'button-primary': '#008C8C',  
                        // Glassmorphism base on the main-bg
                        'card-bg': 'rgba(43, 51, 62, 0.5)', // Slightly less transparent for less 'glassy' look
                    },
                    fontFamily: {
                        sans: ['Times New Roman', 'serif'], // Times New Roman
                    }
                }
            }
        }
    </script>
<style>

    /* 1. Base Styles and Scrollbar */
    body {
        background-color: #2b333e; /* Original color */
        color: white;
        transition: background-color 0.3s;
        font-family: 'Times New Roman', serif;
    }
    /* NEW: Class to disable scrolling on the body when a modal is open */
    .modal-open {
        overflow: hidden;
        /* Compensate for the scrollbar width (8px) to prevent content shift */
        padding-right: 8px; 
    }

    body::-webkit-scrollbar {
        width: 8px;
    }
    body::-webkit-scrollbar-thumb {
        /* FIX: Removed single quotes for color to work */
        background-color: #04a4b0; 
        border-radius: 4px;
    }

    /* 2. Sleek Glassmorphism (Less aggressive shadow/glow) */
    .card-glass {
        background: rgba(43, 51, 62, 0.5); /* Slightly darker/less transparent */
        backdrop-filter: blur(10px); /* Slightly less blur */
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1); /* CLEANER BORDER: Very subtle white border */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Softer shadow */
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    /* ADDED: Subtle hover on card-glass for desktop/larger screens */
    @media (min-width: 768px) {
        .card-glass:hover {
            box-shadow: 0 4px 20px rgba(4, 164, 176, 0.25); /* Slightly stronger glow now */
            transform: translateY(-2px); /* Slightly more aggressive lift */
        }
    }
    
    /* NEW: Custom class for the *subtle* accent border on list items/secondary cards */
    .border-subtle-accent {
        border: 1px solid rgba(4, 164, 176, 0.1); /* Reduced opacity for a cleaner, less "in your face" look */
    }

    /* 3. Hero Section (REDUCED HEIGHT) */
    .hero-background {
        width: 100%;
        min-height: 30vh; /* REDUCED from 50vh */
        position: absolute; 
        top: 0;
        left: 0;
        overflow: hidden;
        z-index: -3; 
    }
    .hero-background::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url('https://i.ibb.co/DHf41tLP/0602-1.png');
        background-size: cover;
        background-position: center;
        filter: blur(5px) brightness(0.4); 
        transform: scale(1.05);
        z-index: -2;
        transition: transform 0.8s ease;
    }
    .hero-background::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to top, #2b333e 5%, transparent 60%);
        z-index: -1;
    }
    .hero-content-wrapper {
        min-height: 30vh; /* REDUCED from 50vh */
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative; 
    }

    /* 4. Navigation Bar (Muted Hover and Active State) */
    nav {
        z-index: 50;
    }
    .nav-link {
        transition: all 0.2s;
        padding: 0.75rem 1rem; 
        border-radius: 0.5rem; 
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.05);
        flex-grow: 1; 
        justify-content: center;
        font-size: 1rem; 
        text-align: center; 
    }
    @media (min-width: 640px) { /* sm breakpoint */
        .nav-link {
            flex-grow: 0;
            font-size: 1.125rem; /* text-lg */
            justify: flex-start;
            text-align: left;
        }
    }

    .nav-link:hover {
        background: rgba(4, 164, 176, 0.1); 
        color: white;
        transform: translateY(-1px); 
        box-shadow: 0 2px 5px rgba(4, 164, 176, 0.1);
    }
    .nav-link.active {
        color: white;
        background: #04a4b0; 
        box-shadow: 0 0 10px rgba(4, 164, 176, 0.4);
        transform: none; 
    }
    .nav-link.active i {
        color: #2b333e; 
    }

    /* NEW: CSS for Mobile Navigation Menu Animation */
    #nav-menu {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.4s ease-out, opacity 0.4s ease-out, padding 0.4s ease-out;
    }
    #nav-menu.open {
        max-height: 500px; 
        opacity: 1;
        padding-top: 0.75rem; 
    }
    /* Revert the flex property on desktop */
    @media (min-width: 640px) { /* sm breakpoint */
        #nav-menu {
            max-height: none !important;
            opacity: 1 !important;
            overflow: visible !important;
            padding-top: 0 !important;
        }
    }

    /* 5. Smoother Changelog Accordion and Rotating Arrow (REVISED FOR SMOOTHNESS) */
/* 5. Smoother Changelog Accordion (REVISED FOR SMOOTHNESS) */
.changelog-entry {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
}

.changelog-header {
    cursor: pointer;
    /* REDUCED PADDING ON MOBILE */
    padding: 1rem; 
    transition: background-color 0.3s ease-in-out; 
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
/* RESTORE PADDING ON LARGER SCREENS */
@media (min-width: 640px) {
    .changelog-header {
        padding: 1.5rem;
    }
}

.changelog-header:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.changelog-header i {
    /* Updated default color to #008C8C (button-primary) */
    color: #008C8C; 
    transition: transform 0.3s ease;
}

.changelog-header i.rotated {
    /* Updated rotated color to #008C8C */
    transform: rotate(180deg);
    color: #008C8C; /* Changed from #00c7d4 to #008C8C */
}

.changelog-content {
    /* CRITICAL for smooth slide effect */
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden; 
}

/* Polishing the change blocks inside */
.changelog-change-block {
    background-color: rgba(255, 255, 255, 0.03); 
    border: 1px solid rgba(4, 164, 176, 0.1); 
    border-left: 5px solid #04a4b0; /* Accent border */
    /* ADDED: Reduced mobile padding on the change blocks */
    padding: 1rem; 
    margin-bottom: 0.5rem;
}
@media (min-width: 640px) {
    .changelog-change-block {
        padding: 1.5rem;
        margin-bottom: 1rem;
    }
}
    
    /* 6. Mobile adjustments for overall padding and flow */
    /* Reduce padding on the main content wrapper on small screens */
    /* Adjusted the original block to target the spacing more effectively */
    .main-wrapper {
        /* Default small padding and reduced space-y */
        padding: 1rem !important; 
        padding-top: 0 !important; 
        /* ADDED: Reduce spacing between sections on mobile */
        --tw-space-y-reverse: 0;
        margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));
        margin-bottom: calc(1.5rem * var(--tw-space-y-reverse));
        
    }
    /* Restored original spacing on larger screens (sm:space-y-8) */
    @media (min-width: 640px) {
        .main-wrapper {
            padding: 2rem !important; /* sm:p-8 */
            padding-top: 0 !important; 
            --tw-space-y-reverse: 0;
            margin-top: calc(2rem * calc(1 - var(--tw-space-y-reverse)));
            margin-bottom: calc(2rem * var(--tw-space-y-reverse));
        }
    }


    /* 7. Specific Download Button Hover */
    #download-button:hover {
        background-color: white !important; /* Force white background on hover */
        color: #2b333e !important; /* Text color back to main-bg color for contrast */
    }

    /* 8. Fullscreen 404 Error Page - ENHANCED STYLING */
    #content-404 {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #2b333e; /* Match main-bg */
        z-index: 100; /* Ensure it covers everything */
        display: none; /* Controlled by JS */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

	.lottie-404 {
		width: 100% !important; /* Forces the width to be 100% */
		max-width: 300px; 
		height: auto;
	}
    
    /* NEW: Lottie Security Enhancement */
    /* Prevents right-click, selection, and other pointer interactions on all Lottie elements */
    dotlottie-wc {
        user-select: none; /* Standard property */
        -moz-user-select: none; /* Firefox */
        -webkit-user-select: none; /* Safari/Chrome */
        -ms-user-select: none; /* IE/Edge */
        pointer-events: none; /* Disables all mouse events on the element */
        cursor: default; /* Ensures no hover cursor appears */
    }
    
    /* NEW: Mobile Font and Spacing Adjustments */
    @media (max-width: 639px) {
        /* Smaller font size for main text on mobile */
        .text-lg.text-start.md\:text-justify {
            font-size: 1.05rem; /* Slightly smaller than 1.125rem (text-lg) */
            line-height: 1.6;
        }
        /* Fix the justified text issue on mobile by forcing left alignment */
        .text-start {
            text-align: left !important;
        }
        
        /* Reduce card padding on small screens (original was p-6 sm:p-8) */
        .card-glass.p-6.sm\:p-8 {
            padding: 1.25rem !important; /* p-5 */
        }
    }
</style>
</head>
<body class="min-h-screen">

<nav id="site-nav" class="sticky top-0 z-50 w-full p-4">
    <div class="max-w-5xl mx-auto p-2 rounded-xl shadow-2xl card-glass">
        <div class="flex justify-between items-center sm:hidden p-2">
            <h2 class="text-xl font-bold text-link-primary">Navigation</h2>
            <button id="menu-button" class="text-white/80 hover:text-white transition duration-200 p-1">
                <i id="menu-icon" class="fas fa-bars text-2xl"></i>
            </button>
        </div>

        <div id="nav-menu" class="sm:block">
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-5 text-lg font-semibold text-white/80 pt-2 sm:pt-0 sm:justify-center">
                
                <a href="#section=home" class="nav-link active flex-1" data-section="home">
                    <i class="fas fa-home mr-2 text-link-primary transition-colors duration-200"></i>Home
                </a>

                <a href="#section=about" class="nav-link flex-1 text-base sm:text-lg" data-section="about">
                    <i class="fas fa-toolbox mr-2 text-link-primary transition-colors duration-200"></i>Tools & Logic
                </a>
                <a href="#section=changelog" class="nav-link flex-1 text-base sm:text-lg" data-section="changelog">
                    <i class="fas fa-code-branch mr-2 text-link-primary transition-colors duration-200"></i>Update Log
                </a>
                <a href="#section=database" class="nav-link flex-1 text-base sm:text-lg" data-section="database">
                    <i class="fas fa-database mr-2 text-link-primary transition-colors duration-200"></i>Database
                </a>
                
            </div>
        </div>
    </div>
</nav>


    <div class="hero-background"></div>

    <div id="download-modal-backdrop" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none">
        <div id="download-modal-content" class="bg-card-bg p-6 sm:p-8 rounded-2xl shadow-2xl max-w-sm w-11/12 transform scale-90 transition-all duration-300 relative border-2 border-link-primary/50 card-glass">

            <button id="modal-close-button" class="absolute top-3 right-3 text-white/50 hover:text-white transition duration-200">
                <i class="fas fa-times-circle text-2xl"></i>
            </button>

            <div class="flex flex-col items-center text-center space-y-4">
                <dotlottie-wc
                    src="https://lottie.host/be23f1e0-b091-46b7-8a08-ae79a6f4bb51/KAzxaEOB4s.lottie"
                    style="width: 300px;"
                    autoplay loop>
                </dotlottie-wc>

                <h3 class="text-3xl font-bold text-link-primary">Download Initiated!</h3>
                <p id="modal-message" class="text-white/80 text-lg">
                    The automatic download for version <b>${versionNumber}</b> is starting now. Check your browser's download folder.
                </p>

                <button onclick="document.getElementById('modal-close-button').click()"
                    class="mt-4 w-full px-6 py-3 text-lg font-semibold text-main-bg bg-button-primary rounded-xl transition duration-300 hover:bg-opacity-80 active:scale-95 shadow-lg">
                    <i class="fas fa-thumbs-up mr-2"></i> Got It
                </button>
            </div>
        </div>
    </div>
    
    <div id="welcome-modal-backdrop" class="fixed inset-0 bg-black bg-opacity-90 z-[60] flex items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none">
        <div id="welcome-modal-content" class="bg-card-bg p-6 sm:p-8 rounded-2xl shadow-2xl max-w-sm w-11/12 transform scale-90 transition-all duration-300 relative border-2 border-link-primary/50 card-glass">

            <div class="flex flex-col items-center text-center space-y-4">
                
                <dotlottie-wc
                    src="https://lottie.host/99429067-13da-4230-aadd-6a64a320efdd/afkbdvOdwj.lottie"
                    style="width: 600px;" class="max-w-full mx-auto" autoplay loop>
                </dotlottie-wc>
                <h3 class="text-3xl font-bold text-link-primary">Quiz for Survival</h3>
                <p class="text-white/80 text-lg">
                    The latest version is available! Would you like to start the download now?
                </p>

                <button id="welcome-download-button"
                    class="mt-4 w-full px-6 py-3 text-lg font-semibold text-main-bg bg-button-primary rounded-xl transition duration-300 hover:bg-opacity-80 active:scale-95 shadow-lg animate-pulse hover:animate-none">
                    <i class="fas fa-cog fa-spin mr-2"></i> Initializing...
                </button>

                <button id="welcome-continue-button"
                    class="w-full px-6 py-3 text-lg font-semibold text-white/70 hover:text-white transition duration-300 border border-white/30 rounded-xl hover:bg-white/10 active:scale-95">
                    <i class="fas fa-arrow-right mr-2"></i> Continue to Website
                </button>
            </div>
        </div>
    </div>


    <header id="site-header" class="hero-content-wrapper">
        <div class="text-center p-8 z-10 max-w-5xl mx-auto">
            <h1 id="hero-title" class="text-5xl sm:text-7xl font-extrabold tracking-tight text-white mb-4">
                Quiz for Survival
            </h1>
            <p id="hero-subtitle" class="text-xl sm:text-3xl text-link-primary font-light tracking-wider">
                The ultimate trivia experience of knowledge, strategy, and survival.
            </p>
        </div>
    </header>
    
    <div id="main-page-wrapper" class="max-w-5xl mx-auto space-y-6 sm:space-y-8 p-4 sm:p-8 pt-0 main-wrapper">

        <main id="main-content" class="space-y-6 sm:space-y-8">

            <section id="content-home" class="content-section space-y-6 sm:space-y-8">
                
                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-link-primary border-b border-link-primary/50 pb-4 flex items-center">
                        <i class="fas fa-book-open mr-3 text-2xl"></i> About the Game
                    </h2>
                    <p class="text-white/90 leading-relaxed text-lg text-start md:text-justify">
						<span class="font-bold text-link-primary">
							<a href="https://fillabrona.itch.io/quiz-for-survival" target="_blank">Quiz for Survival</a>
						</span> is an intense trivia experience that challenges your knowledge, strategy, and risk management with over 2,500 questions across categories like General Knowledge, Sports, History, Games, Geography, Language, Music, Math, and Measurements. Each round features 10 randomly selected questions with four answer choices, but only one is correct, keeping every playthrough unpredictable. Correct answers award 10 points and 5 coins, while wrong answers reduce health by 10 and cost 3 coins, adding tension and strategy to every decision. After each round, the shop opens, letting you spend coins on Health Potions, Extra Lives, Mystery Boxes, Lucky Triples, and more, to enhance your survival chances. With four gameplay modes, Normal, Gauntlet, Shopless, and Multiplayer, and five difficulty levels Unlimited, Easy, Hard, Extreme, and Unbeatable, players can tailor the challenge to their skill. The game also features 15 achievements, a top-30 leaderboard, and an in-game feedback system for feedback & suggestions. When you reach the target score, a victory screen summarizes your performance, including final score, coins, health, completion time, correct and wrong answers, and a performance rating out of 100, giving a clear picture of how well you did. Combining knowledge, risk, and strategy, Quiz for Survival is an addictive, fast-paced trivia game that tests both your skill and endurance, rewarding careful play and quick thinking alike.
					</p>
                </div>

                <div id="latest-version-card" class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">

                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between border-b border-button-primary/50 pb-4">
                        <h2 id="latest-version-heading" class="text-2xl sm:text-3xl font-bold text-button-primary flex items-center mb-2 sm:mb-0">
                            <i class="fas fa-spinner fa-spin mr-3 text-2xl"></i> Loading Update Info...
                        </h2>
                        <div id="latest-version-meta" class="text-right flex flex-col items-end space-y-0 pt-2 sm:pt-0">
                            <p class="text-2xl font-bold text-white" id="version-display">Loading...</p>
                            <p class="text-white/70 text-xs" id="author-info">by...</p>
                        </div>
                    </div>

                    <div id="latest-version-content" class="min-h-[100px]">
                        <div id="version-placeholder" class="space-y-4 animate-pulse">
                            <div class="h-5 bg-gray-600 rounded w-1/4"></div>
                            <div class="space-y-2 pl-6">
                                <div class="h-4 bg-gray-700 rounded w-full"></div>
                                <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                            </div>
                        </div>
                    </div>

                    <div id="file-stats-wrapper" class="pt-4">
                        
                        <div id="file-stats-placeholder" class="flex justify-center space-x-8">
                            <div class="flex flex-col items-start w-24">
                                <div class="h-3 bg-gray-600 rounded w-1/2 animate-pulse mb-1"></div>
                                <div class="h-4 bg-gray-700 rounded w-full animate-pulse"></div>
                            </div>
                            <div class="flex flex-col items-start w-24">
                                <div class="h-3 bg-gray-600 rounded w-1/2 animate-pulse mb-1"></div>
                                <div class="h-4 bg-gray-700 rounded w-full animate-pulse"></div>
                            </div>
                        </div>
                        
                        <div id="file-stats-content" class="hidden flex justify-center space-x-8">
                            <div class="flex items-center">
                                <i class="fas fa-file-archive text-white/40 text-base mr-2 flex-shrink-0"></i>
                                <div class="flex flex-col text-left">
                                    <p class="text-white/70 text-xs font-semibold leading-none">File Size</p>
                                    <p id="file-size-value" class="text-white/90 font-normal text-sm leading-none pt-0.5">...</p>
                                </div>
                            </div>

                            <div class="flex items-center">
                                <i class="fas fa-chart-line text-white/40 text-base mr-2 flex-shrink-0"></i>
                                <div class="flex flex-col text-left">
                                    <p class="text-white/70 text-xs font-semibold leading-none">Total Downloads</p>
                                    <p id="download-count-value" class="text-white/90 font-normal text-sm leading-none pt-0.5">...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pt-6 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-8">
                        <button id="download-button"
                            class="w-11/12 sm:w-auto px-12 py-4 text-xl font-bold text-main-bg uppercase transition duration-300 transform bg-link-primary rounded-xl shadow-lg hover:shadow-xl hover:bg-link-primary/90 active:scale-95 disabled:opacity-50 tracking-wider">
                            <i class="fas fa-cog fa-spin mr-2"></i> Initializing...
                        </button>
                    </div>
                </div>

                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-link-primary border-b border-link-primary/50 pb-4 flex items-center">
                        <i class="fas fa-rocket mr-3 text-2xl"></i> Upcoming Features
                    </h2 >
                    <div id="whats-next-content" class="min-h-[100px]">
                        <div id="roadmap-placeholder" class="space-y-4 animate-pulse">
                             <div class="h-5 bg-gray-600 rounded w-1/3"></div>
                            <div class="space-y-2 pl-6">
                                <div class="h-4 bg-gray-700 rounded w-full"></div>
                                <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="content-about" class="content-section space-y-6 sm:space-y-8 hidden">
                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-toolbox mr-3 text-2xl"></i> Shop Tools
                    </h3>
                    <div id="tools-content" class="grid md:grid-cols-2 gap-4 sm:gap-6">
                        </div>
                </div>

                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-box-open mr-3 text-2xl"></i> Mystery Box Rewards & Mechanics
                    </h3>
                    <div id="mystery-box-content" class="space-y-4">
                        </div>
                </div>

                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-dice-three mr-3 text-2xl"></i> Lucky Triples Rewards
                    </h3>
                    <div id="lucky-triples-content" class="space-y-4">
                        </div>
                </div>
            </section>

            <section id="content-changelog" class="content-section space-y-6 sm:space-y-8 hidden">
                <div class="card-glass p-0 rounded-2xl shadow-xl overflow-hidden">
                    <div id="changelog-content">
                        </div>
                </div>
            </section>

            <section id="content-database" class="content-section space-y-6 sm:space-y-8 hidden">
                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-gamepad mr-3 text-2xl"></i> Game Modes
                    </h3>
                    <div id="modes-content" class="grid md:grid-cols-2 gap-4 sm:gap-6">
                        </div>
                </div>

                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-brain mr-3 text-2xl"></i> Difficulty Levels
                    </h3>
                    <div id="difficulties-content" class="grid md:grid-cols-2 gap-4 sm:gap-6">
                        </div>
                </div>

                <div class="card-glass p-6 sm:p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl sm:text-3xl font-bold text-button-primary border-b border-button-primary/50 pb-3 flex items-center">
                        <i class="fas fa-trophy mr-3 text-2xl"></i> All Achievements
                    </h3>
                    <div id="achievements-content" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                        </div>
                </div>
            </section>

        </main>
    </div>
    
<section id="content-404" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="flex flex-col items-center">
        <dotlottie-wc id="lottie-404" class="lottie-404 mx-auto mb-8" autoplay loop
            src="https://lottie.host/47ace394-5c3b-4f9b-b3fc-b6a2e0514288/IFwzZgHc8T.lottie"
            style="width: 300px;">
        </dotlottie-wc>
        <h3 class="text-3xl sm:text-4xl font-bold text-white mb-6 mt-[-1rem]">Page Not Found</h3>

        <p class="text-xl text-white/80 mb-10 max-w-sm text-center">
            It looks like the link you followed doesn't exist here. Time to head back to the quiz!
        </p>

        <a href="#section=home" id="404-home-link"
            class="inline-block px-10 py-3 text-xl font-semibold text-main-bg bg-button-primary rounded-xl transition duration-300 hover:bg-opacity-80 active:scale-95 shadow-lg">
            <i class="fas fa-arrow-left mr-2"></i> Go to Home
        </a>
    </div>
</section>

    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, onSnapshot, updateDoc, increment, setDoc, Transaction, runTransaction, 
            getDoc, collection, getDocs, setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- FIREBASE CONFIGURATION (REDACTED FOR SECURITY) ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCAmYCabtz0apNHmyw9w6Jlr2lPpyXDUKk", 
            authDomain: "downlodsqfs.firebaseapp.com",
            projectId: "downlodsqfs",
            storageBucket: "downlodsqfs.firebasestorage.app",
            messagingSenderId: "597637748461",
            appId: "1:597637748461:web:a24eb0794427a38aa11ee4",
            measurementId: "G-1FWDCC5GH4" 
        };

        // Canvas environment variables for ID and Auth
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db = null;
        let auth = null;
        let downloadCounterRef = null;

        // --- FIREBASE INITIALIZATION AND AUTHENTICATION ---
        const initializeFirebase = async () => {
            try {
                // setLogLevel('debug'); // Uncomment for debugging
                const app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Define the public Firestore path for the download counter
                // Path: /artifacts/{appId}/public/data/qfs_downloads/counter
                downloadCounterRef = doc(db, 'artifacts', appId, 'public', 'data', 'qfs_downloads', 'counter');
                
                // Initialize the counter if it doesn't exist
                const counterSnap = await getDoc(downloadCounterRef);
                if (!counterSnap.exists()) {
                    await setDoc(downloadCounterRef, { count: 0 });
                }

                console.log("Firebase initialized and authenticated.");

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }
        };

        // --- FIRESTORE LOGIC ---
        
        // 1. Listen for real-time changes to the download count
        const startDownloadListener = () => {
            if (!downloadCounterRef) return;

            // FIX: This listener now runs immediately and updates the count value regardless 
            // of the placeholder status. The placeholder is hidden once the main Gist data loads.
            onSnapshot(downloadCounterRef, (doc) => {
                const count = doc.exists() ? doc.data().count : 0;
                // Update the visible counter value directly
                document.getElementById('download-count-value').textContent = count.toLocaleString();
            }, (error) => {
                console.error("Error listening to download count:", error);
                document.getElementById('download-count-value').textContent = 'Error';
            });
        };

        // 2. Increment the download count transactionally
        const incrementDownloadCount = async () => {
            if (!downloadCounterRef) {
                console.error("Download Counter Ref is not initialized.");
                return;
            }

            try {
                // Use a transaction to safely increment the count
                await runTransaction(db, async (transaction) => {
                    const sfDoc = await transaction.get(downloadCounterRef);
                    if (!sfDoc.exists()) {
                        // Create it if it still doesn't exist (should be rare)
                        transaction.set(downloadCounterRef, { count: 1 });
                    } else {
                        // Increment the existing count
                        const newCount = sfDoc.data().count + 1;
                        transaction.update(downloadCounterRef, { count: increment(1) });
                    }
                });
                console.log("Download count incremented successfully.");
            } catch (error) {
                console.error("Transaction failed to increment download count:", error);
            }
        };


        // --- MAIN APP LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const URLS = {
                masterData: 'https://gist.githubusercontent.com/Fillabrona/5a17fe172177f74a4a65196ba1b53c50/raw/100d1cf2ecc22b85ce82c17c0cc1f187895c26fa/downloadinfo',
            };
			
            // Lottie file for 404 (single URL, no randomization)
            const LOTTIE_404_URL = 'https://lottie.host/47ace394-5c3b-4f9b-b3fc-b6a2e0514288/IFwzZgHc8T.lottie';

            const SELECTORS = {
                pageTitle: document.getElementById('page-title'),
                mainContent: document.getElementById('main-content'),
                navLinks: document.querySelectorAll('.nav-link'),
                latestVersionHeading: document.getElementById('latest-version-heading'),
                downloadButton: document.getElementById('download-button'),
                versionContentDiv: document.getElementById('latest-version-content'),
                versionMetaDiv: document.getElementById('latest-version-meta'),
                whatsNextDiv: document.getElementById('whats-next-content'),
                
                // Download Initiated Modal
                modalBackdrop: document.getElementById('download-modal-backdrop'),
                modalContent: document.getElementById('download-modal-content'),
                modalCloseButton: document.getElementById('modal-close-button'),
                modalMessage: document.getElementById('modal-message'),
                
                // Welcome Modal Selectors
                welcomeModalBackdrop: document.getElementById('welcome-modal-backdrop'),
                welcomeModalContent: document.getElementById('welcome-modal-content'),
                welcomeDownloadButton: document.getElementById('welcome-download-button'),
                welcomeContinueButton: document.getElementById('welcome-continue-button'),

                // New Section Selectors
                contentHome: document.getElementById('content-home'),
                contentAbout: document.getElementById('content-about'),
                contentChangelog: document.getElementById('content-changelog'),
                contentDatabase: document.getElementById('content-database'),
                content404: document.getElementById('content-404'), // 404 Selector
                toolsContent: document.getElementById('tools-content'),
                mysteryBoxContent: document.getElementById('mystery-box-content'),
                luckyTriplesContent: document.getElementById('lucky-triples-content'),
                modesContent: document.getElementById('modes-content'),
                difficultiesContent: document.getElementById('difficulties-content'),
                achievementsContent: document.getElementById('achievements-content'),

                // Dynamic Hero Selectors
                heroTitle: document.getElementById('hero-title'),
                heroSubtitle: document.getElementById('hero-subtitle'),

                // Burger Menu Selectors
                menuButton: document.getElementById('menu-button'),
                navMenu: document.getElementById('nav-menu'),
                menuIcon: document.getElementById('menu-icon'),
                siteNav: document.getElementById('site-nav'), // Nav element wrapper
                siteHeader: document.getElementById('site-header'), // Header element wrapper
                mainPageWrapper: document.getElementById('main-page-wrapper'), // Main content wrapper

                // New Stat Displays
                versionDisplay: document.getElementById('version-display'),
                authorInfo: document.getElementById('author-info'),
                fileSizeValue: document.getElementById('file-size-value'),
                downloadCountValue: document.getElementById('download-count-value'),

                // New Stat Loaders
                fileStatsPlaceholder: document.getElementById('file-stats-placeholder'),
                fileStatsContent: document.getElementById('file-stats-content'),

                // 404 Specific
                lottie404: document.getElementById('lottie-404'),
                homeLink404: document.getElementById('404-home-link'),
            };

            // List of all valid content sections
            const VALID_SECTIONS = ['home', 'about', 'changelog', 'database'];

            const SECTION_TITLES = {
                'home': { title: 'Quiz for Survival', subtitle: 'The ultimate trivia experience of knowledge, strategy, and survival.' },
                'about': { title: 'Game Mechanics & Tools Logic', subtitle: 'Understanding the shop tools, mystery box rewards, and Lucky Triples mechanics.' },
                'changelog': { title: 'Game Update Log', subtitle: 'A detailed history of all game versions, features, and fixes.' },
                'database': { title: 'Game Database', subtitle: 'Explore all game modes, difficulty levels, and achievements.' },
            };

            const defaultButtonText = '<i class="fas fa-download mr-2"></i> Download Latest Version';

            // üí° HARDCODED FILE SIZE (used as fallback for loading errors)
            const HARDCODED_FILE_SIZE = 'N/A';

            const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            // --- Game Data from Request (Parsed and Structured) ---
            const GAME_DATA = { 
                // ... (Original static data is omitted for brevity but remains implicitly the same)
                changelog: [
                    { version: 'v1.7.0', changes: ['Multiplayer Mode has been added, letting you play and compete with friends, family, or anyone online, along with new sounds, improved visuals, and fixes for bugs and lag. And fixed some achievement logic, also topped it off with animations for victories and more.', 'Added 5 new achievements, fixed animation replay issues, and introduced a secret reward for unlocking the \'Curiosity Pays\' achievement. Improved the UI and added extra stats to the victory screen, including average performance rating, total correct and wrong answers, and more, along with various other tweaks.'] },
                    { version: 'v1.6.4', changes: ['A new Achievements section has been added to the game, featuring new music tracks and 10 additional achievements to unlock. These new additions aim to make the game even more engaging and motivate players to actively pursue and earn achievements.'] },
                    { version: 'v1.6.3', changes: ['A total of 1000 new questions have been added to enhance gameplay depth and a fully automated leaderboard has been introduced. Additionally, several new features have been introduced, along with various tweaks and bug fixes to improve overall performance and user experience.'] },
                    { version: 'v1.6.2', changes: ['A new timed stat has been added, allowing you to track how long it took to reach the victory screen‚Äîa great way to challenge yourself and refine your skills. Minor user interface tweaks have also been implemented to improve readability and consistency across all devices. Additionally, several issues with the logic of certain tools have been fixed, ensuring they work as intended during gameplay.'] },
                    { version: 'v1.6.1', changes: ['Tools in the shop were adjusted to be more cost-effective, with some tools receiving buffs while remaining reasonably priced. The Gauntlet Mode timer no longer glitches as frequently as it did in version 1.6.0. Additionally, some logic issues within the game were addressed, including the logic behind the Double Score Booster'] },
                    { version: 'v1.6.0', changes: ['A new tool has been added to the shop, featuring a completely redesigned UI. Two additional game modes have been introduced alongside the existing normal mode, now integrated with the ‚ÄúGauntlet‚Äù and ‚ÄúShopless‚Äù modes. The update also includes new features, extended music and sound options, UI enhancements, and a refresh button to easily reconnect to the internet'] },
                    { version: 'v1.5.2', changes: ['Fixed minor glitches and bugs, including issues with opening new screens and slow performance and newly redesigned rounded icon for a refreshed look'] },
                    { version: 'v1.5.1', changes: ['A feedback and suggestions feature has been added, allowing users to type a message and choose either "suggestions" or "feedback." The input is then sent to Discord, where the developer can review it and potentially implement it into the game. New sounds have been added, and various flaws have been fixed'] },
                    { version: 'v1.5.0', changes: ['A new and improved user interface has been introduced, ensuring compatibility with all versions of Windows. Minor bugs, buffer issues, and glitches have been resolved, and resolution support has been optimized across all devices, including monitors and laptops'] },
                    { version: 'v1.4.3', changes: ['The game now requires an active internet connection for full functionality. This enables the leaderboard to update automatically and in real-time. Several flaws and glitches were fixed, and a few UI tweaks and new music implementations were added'] },
                    { version: 'v1.4.2', changes: ['Added a screenshot feature‚Äîdouble-clicking the quiz or victory screen now captures a shot of your wild scores, funny glitches, or memorable moments. Minor glitches were fixed, and a new ‚ÄúUnbeatable‚Äù difficulty was introduced, requiring a massive 5000 points to win. A new mystery item, ‚ÄúYou Took My Score,‚Äù has been added to the Mystery Box, which deducts 20% of your current score if drawn'] },
                    { version: 'v1.4.1', changes: ['Added clickable links and UI tweaks, fixed visual bugs, and introduced the Mystery Box tool in the shop‚Äîa purchasable item with cool rewards to be won'] },
                    { version: 'v1.4.0', changes: ['Fully automated keyboard accessibility‚Äîno mouse needed‚Äîenhanced visuals and sounds, and fully functional difficulty settings (Easy, Hard, and Extreme) that trigger a victory screen when the target score is reached.'] },
                    { version: 'v1.3.3', changes: ['The update notification now includes an expanded and more detailed visual design, along with a revamped startup menu that displays helpful tips and additional information'] },
                    { version: 'v1.3.2', changes: ['Added an update checker to notify users of new updates, along with bug fixes and UI adjustments'] },
                    { version: 'v1.3.1', changes: ['Two new tools added to the shop, along with 500 new questions, greatly expanding the depth of gameplay'] },
                    { version: 'v1.3.0', changes: ['A brand-new music track, and sound effects with an 8-bit retro vibe, UI enhancements in the leaderboard, bug fixes, and a new tool added to the shop'] },
                    { version: 'v1.2.2', changes: ['Nothing major, just some bug fixes and UI tweaks'] },
                    { version: 'v1.2.1', changes: ['Not much changed, just new players added to the leaderboard'] },
                    { version: 'v1.2.0', changes: ['New font implemented, leaderboard added, UI and in-game stats fixed, and total coins display updated in the shop'] },
                    { version: 'v1.1.0', changes: ['Resolved bugs, added new features, and introduced new tools for use'] },
                    { version: 'v1.0.0', changes: ['The game‚Äôs opening sequence, featuring all core functions and visual elements'] },
                ], 
                tools: [
                    { name: 'Health Potion', price: '10 Coins', description: 'Restores 25 Health points', cooldown: 'Null' },
                    { name: 'Coin Boost', price: '15 Coins', description: 'Gains 10 extra coins (Not a scam)', cooldown: 'Null' },
                    { name: 'Skipper', price: '20 Coins', description: 'Makes you skip any 3 questions you hesitate or don‚Äôt know the answer to', cooldown: 'Null' },
                    { name: 'Mystery Box', price: '30 Coins', description: 'Provides a random item. Lower-cost items have a higher chance of appearing, while higher-cost items are less likely to drop due to their rarity', cooldown: 'Null' },
                    { name: 'Extra Life', price: '35 Coins', description: 'Grants you a whole new life (100 Health points)', cooldown: 'Null' },
                    { name: 'Shield', price: '35 Coins', description: 'Blocks 5 wrong answers from losing money', cooldown: 'Null' },
                    { name: 'Double Score Boost', price: '45 Coins', description: 'Doubles the score from correct answers for the next 5 questions', cooldown: 'Null' },
                    { name: '50/50', price: '60 Coins', description: 'Removes two wrong answers (usable 10 times)', cooldown: 'Null' },
                    { name: 'Lucky Triples', price: '65 Coins', description: 'Try to triple your coins or health, but risk losing a third.', cooldown: '3 Min / 5 Min*' },
                    { name: 'Double Score', price: '70 Coins', description: 'Doubles your current score', cooldown: '3 Min / 5 Min*' },
                ],
                mysteryBox: [
                    { item: 'More coins', rarity: 'Common', howItWorks: 'Adds 15 coins to your coins (Not a scam)' },
                    { item: 'Health Booster', rarity: 'Common', howItWorks: 'Adds 50 Health points to your current Health points' },
                    { item: 'Skips', rarity: 'Uncommon', howItWorks: 'Gives you 5 Skips to use' },
                    { item: 'Shield', rarity: 'Uncommon', howItWorks: 'Activates shield once' },
                    { item: 'You took my points!', rarity: 'Uncommon', howItWorks: 'Deducts 20% of your current score' },
                    { item: 'Score Booster', rarity: 'Rare', howItWorks: 'Uses the formula (Health / Score) * 4 to calculate a multiplier, which is applied to the current Score. Capped and rounded for balance.' },
                    { item: 'Double Score', rarity: 'Super rare', howItWorks: 'Multiplies your current score by 2' },
                ],
                luckyTriples: [
                    { item: 'Coin Tripler', chance: '40% Chance', howItWorks: 'Current coins are tripled' },
                    { item: 'Health Tripler', chance: '40% Chance', howItWorks: 'Current health is tripled' },
                    { item: 'I‚Äôm Unlucky', chance: '20% Chance', howItWorks: 'Coins and Health are multiplied by two-thirds, effectively losing one-third.' },
                ],
                difficulties: [
                    { name: 'Unlimited', score: '0', description: 'Goes on until you lose' },
                    { name: 'Easy', score: '250', description: 'Score of 250 needed to win' },
                    { name: 'Hard', score: '500', description: 'Score of 500 needed to win' },
                    { name: 'Extreme', score: '1000', description: 'Score of 1000 needed to win' },
                    { name: 'Unbeatable', score: '5000', description: 'Score of 5000 needed to win' },
                ],
                modes: [
                    { name: 'Normal', icon: 'fas fa-check-circle', description: 'Standard gameplay with the default settings' },
                    { name: 'Gauntlet', icon: 'fas fa-hourglass-start', description: 'You have only 5 minutes to achieve the highest score you can' },
                    { name: 'Shopless', icon: 'fas fa-ban', description: 'Play without a shop, rendering coins essentially worthless' },
                    { name: 'Multiplayer', icon: 'fas fa-users', description: 'Play with friends online, and see who finishes first' },
                ],
                achievements: [
                    { name: 'Novice Survivor', subtitle: '‚ÄúEvery survivor starts somewhere.‚Äù', description: 'Beat Easy difficulty', icon: 'fas fa-medal' },
                    { name: 'Tough Challenger', subtitle: '‚ÄúYou‚Äôve proven you can handle the pressure.‚Äù', description: 'Beat Hard difficulty', icon: 'fas fa-shield-alt' },
                    { name: 'Fearless Mind', subtitle: '‚ÄúYou thrive where others crumble.‚Äù', description: 'Beat Extreme difficulty', icon: 'fa-solid fa-skull' },
                    { name: 'Unstoppable', subtitle: '‚ÄúThe trivia gods fear you now.‚Äù', description: 'Beat Unbeatable difficulty', icon: 'fas fa-crown' },
                    { name: 'Master of Survival', subtitle: '‚ÄúFrom the first match to the final stand. You‚Äôve done it all.‚Äù', description: 'Beat all difficulties at least once', icon: 'fas fa-star' },
                    { name: 'Shopless Titan', subtitle: '‚ÄúWho needs items when you‚Äôve got skill?‚Äù', description: 'Score more than 1,500 points in Shopless Mode', icon: 'fas fa-shopping-bag' },
                    { name: 'Gauntlet Blitzer', subtitle: '‚ÄúFast hands, faster mind.‚Äù', description: 'Score more than 1,500 points within 5 minutes in Gauntlet Mode', icon: 'fas fa-running' },
                    { name: 'Curiosity Pays', subtitle: '‚ÄúYou clicked where no one dared to click.‚Äù', description: 'Find the hidden easter egg', icon: 'fas fa-egg' },
                    { name: 'Hall of Fame', subtitle: '‚ÄúYour name is now carved into survival history.‚Äù', description: 'Get onto the leaderboard', icon: 'fas fa-trophy' },
                    { name: 'Broken Piggy Bank', subtitle: '‚ÄúYou smashed that piggy bank wide open.‚Äù', description: 'Earn more than 200 coins in a single run', icon: 'fa-solid fa-money-bill' },
                    { name: 'The Centurion', subtitle: '‚ÄúTrue endurance is rare.‚Äù', description: 'Answer 100 questions correctly in a single run', icon: 'fas fa-fire' },
                    { name: 'Score Titan', subtitle: '‚ÄúOnly the best of the best reach this level.‚Äù', description: 'Achieve a score of 10,000 in a single game', icon: 'fas fa-chart-line' },
                    { name: 'The Shoplifter', subtitle: '‚ÄúSometimes you spend big to win big.‚Äù', description: 'Purchase at least 15 items at the shop in a single run', icon: 'fas fa-cart-arrow-down' },
                    { name: 'Perfect Time', subtitle: '‚ÄúSpeed, accuracy, and efficiency.‚Äù', description: 'Get a score of at least 500 in under 2 minutes', icon: 'fas fa-stopwatch' },
                    { name: 'Godlike Streak', subtitle: '‚ÄúAn uninterrupted display of knowledge.‚Äù', description: 'Answer 25 questions in a row correctly', icon: 'fas fa-bolt' },
                ],
            };
            // --- End Game Data ---


            // --- Modal Functions (UPDATED) ---
            const showDownloadModal = (versionNumber) => {
                // ADDED: Disable body scrolling when modal is open
                document.body.classList.add('modal-open');
                
                SELECTORS.modalMessage.innerHTML = `The automatic download for version <b>${versionNumber}</b> is starting now. Check your browser's download folder.`;
                SELECTORS.modalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
                SELECTORS.modalContent.classList.remove('scale-90');

                SELECTORS.modalBackdrop.onclick = (e) => {
                    if (e.target.id === 'download-modal-backdrop') {
                        hideDownloadModal();
                    }
                };
            };

            const hideDownloadModal = () => {
                // ADDED: Re-enable body scrolling when modal is closed
                document.body.classList.remove('modal-open');
                
                SELECTORS.modalBackdrop.classList.add('opacity-0', 'pointer-events-none');
                SELECTORS.modalContent.classList.add('scale-90');
                SELECTORS.modalBackdrop.onclick = null; 
            };
            
            // Welcome Modal Functions (UPDATED)
            const showWelcomeModal = (versionNumber) => {
                // ADDED: Disable body scrolling when modal is open
                document.body.classList.add('modal-open');
                
                SELECTORS.welcomeDownloadButton.innerHTML = `<i class="fas fa-download mr-2"></i> Download ${versionNumber}`;
                SELECTORS.welcomeModalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
                SELECTORS.welcomeModalContent.classList.remove('scale-90');
            };

            const hideWelcomeModal = () => {
                // ADDED: Re-enable body scrolling when modal is closed
                document.body.classList.remove('modal-open');
                
                SELECTORS.welcomeModalBackdrop.classList.add('opacity-0', 'pointer-events-none');
                SELECTORS.welcomeModalContent.classList.add('scale-90');
            };

            // --- End Modal Functions ---


            const formatContentText = (text, iconType = 'fa-feather') => {
                if (!text) return '<p class="text-red-400">Data content is empty.</p>';

                const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                let html = '<ul class="list-none space-y-3 pl-0">';

                lines.forEach(line => {
                    if (line.startsWith('‚Ä¢')) {
                        let content = line.substring(1).trim();
                        // Capitalize the first letter of the content after the bullet for a 'sentence start' look
                        content = content.charAt(0).toUpperCase() + content.slice(1);
                        
                        let iconHtml;
                        if (iconType === 'circle') {
                            // Solid circle bullet (‚óè) - using HTML entity
                            // pt-[2px] aligns the text element itself to compensate for line-height differences
                            iconHtml = `<span class="text-link-primary text-xl mr-3 flex-shrink-0 leading-none pt-[2px]">&#9679;</span>`;
                        } else {
                            // Font Awesome icon (e.g., fas fa-feather)
                            // pt-0.5 is Tailwind equivalent of pt-[2px] or pt-[0.125rem]
                            iconType = iconType === 'fa-feather-alt' ? 'fa-feather-alt' : 'fa-feather';
                            iconHtml = `<span class="text-link-primary text-xl mr-3 flex-shrink-0 leading-none pt-0.5"><i class="fas ${iconType}"></i></span>`;
                        }

                        html += `<li class="flex items-start text-white/90 text-lg">
                            ${iconHtml}
                            <span class="block">${content}</span>
                        </li>`;
                    } else if (line.endsWith(':')) {
                        html += `<li class="pt-4 pb-1 text-xl font-bold text-button-primary">${line}</li>`;
                    } else if (line.match(/^\d+\./)) {
                        html += `<li class="pt-4 text-xl font-bold text-button-primary">${line}</li>`;
                    } else if (line.length > 0) {
                        html += `<li class="text-white/80 pl-6 text-lg">${line}</li>`;
                    }
                });

                html += '</ul>';
                return html;
            };

            const handleFetchError = (error) => {
                console.error("Failed to fetch master data:", error);
                const failureMessage = `<p class="text-red-400 text-center p-6"><i class="fas fa-exclamation-triangle mr-2"></i> Failed to load data. Please check the console for more details.</p>`;
                SELECTORS.latestVersionHeading.innerHTML = '<i class="fas fa-times-circle mr-3 text-2xl"></i> Load Error';
                SELECTORS.versionContentDiv.innerHTML = failureMessage;
                SELECTORS.whatsNextDiv.innerHTML = failureMessage;
                SELECTORS.downloadButton.disabled = true;
                SELECTORS.downloadButton.classList.add('opacity-50', 'cursor-not-allowed');
                SELECTORS.downloadButton.innerHTML = '<i class="fas fa-times-circle mr-2"></i> Link Error';
                
                // Update new stats
                SELECTORS.fileSizeValue.textContent = HARDCODED_FILE_SIZE; // Set to hardcoded value on error
                // The download count is handled by the listener, so we leave it as is or show an error
                SELECTORS.downloadCountValue.textContent = 'Error';
                
                // Hide placeholder and show static content on error
                if (SELECTORS.fileStatsPlaceholder && SELECTORS.fileStatsContent) {
                    SELECTORS.fileStatsPlaceholder.classList.add('hidden');
                    SELECTORS.fileStatsContent.classList.remove('hidden');
                }

                // Disable/Update Welcome Modal on error
                SELECTORS.welcomeDownloadButton.disabled = true;
                SELECTORS.welcomeDownloadButton.innerHTML = '<i class="fas fa-times-circle mr-2"></i> Load Error';
                SELECTORS.welcomeDownloadButton.classList.remove('animate-pulse');
            };

            const fetchMasterData = async (url, retries = 3) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, { cache: "no-store" });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return await response.json();
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed for ${url}.`, error);
                        if (i < retries - 1) await delay(1000 * (2 ** i));
                        else {
                            handleFetchError(error);
                            return null;
                        }
                    }
                }
            };

            const populateHomePage = (data) => {
                try {
                    const versionMatch = data.versionInfo.match(/Game:.*(v[\d.]+)/);
                    const versionNumber = versionMatch ? versionMatch[1] : 'Unknown';
                    const authorLineMatch = data.versionInfo.match(/Author: (.*?)\s-\s(https:\/\/fillabrona\.itch\.io\/)/);
                    const authorName = authorLineMatch ? authorLineMatch[1] : 'Fillabrona';
                    const authorUrl = authorLineMatch ? authorLineMatch[2] : 'https://fillabrona.itch\.io/';
                    
                    // üí° MODIFIED: Read fileSize directly from the fetched data, using HARDCODED_FILE_SIZE as a fallback
                    const fileSize = data.fileSize || HARDCODED_FILE_SIZE; 


                    // 1. Update Meta Data (Version, Author, File Size)
                    SELECTORS.versionDisplay.textContent = versionNumber;
                    SELECTORS.authorInfo.innerHTML = `by
                        <a href="${authorUrl}" target="_blank" class="text-link-primary hover:text-white transition duration-200 font-semibold">${authorName}</a>
                    `;
                    // üí° Set file size to the fetched or fallback value
                    SELECTORS.fileSizeValue.textContent = fileSize; 
                    SELECTORS.latestVersionHeading.innerHTML = `<i class="fas fa-tag mr-3 text-2xl"></i> Latest Update`;

                    // 2. Update Content Sections
                    const updateSection = data.versionInfo.substring(data.versionInfo.indexOf('--- LATEST UPDATE ---') + '--- LATEST UPDATE ---'.length).trim();
                    SELECTORS.versionContentDiv.innerHTML = formatContentText(updateSection, 'fa-feather'); 

                    const roadmapSection = data.whatsNext.substring(data.whatsNext.indexOf('--- UPCOMING FEATURES ---') + '--- UPCOMING FEATURES ---'.length).trim();
                    SELECTORS.whatsNextDiv.innerHTML = formatContentText(roadmapSection, 'circle');
                    
                    // 3. Hide placeholder and show static content (FIX: This ensures the stats are visible)
                    SELECTORS.fileStatsPlaceholder.classList.add('hidden');
                    SELECTORS.fileStatsContent.classList.remove('hidden');


                    // 4. Setup Download Button
                    if (data.downloadLink) {
                        SELECTORS.downloadButton.setAttribute('data-download-url', data.downloadLink);
                        SELECTORS.downloadButton.disabled = false;
                        SELECTORS.downloadButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        SELECTORS.downloadButton.innerHTML = defaultButtonText;
                        
                        // Update welcome button status
                        SELECTORS.welcomeDownloadButton.classList.remove('animate-pulse');
                        SELECTORS.welcomeDownloadButton.innerHTML = `<i class="fas fa-download mr-2"></i> Download ${versionNumber}`;
                    } else {
                        throw new Error("Download link not found in data.");
                    }
                } catch (processingError) {
                    console.error("Error processing fetched data for homepage:", processingError);
                    handleFetchError(processingError);
                }
            };
            
            // --- Content Population Functions (using static data) ---

			const populateChangelogSection = () => {
				let html = '';
				
				GAME_DATA.changelog.forEach((entry) => {
					// Date formatting logic REMOVED

					const changes = entry.changes.map((c, index) => {
						let content = c.trim();
						content = content.charAt(0).toUpperCase() + content.slice(1);
						
						// Use the desired display for individual change blocks
						return `
							<div class="changelog-change-block p-4 sm:p-6 rounded-lg shadow-md">
								<h5 class="text-link-primary font-bold mb-1">${entry.changes.length > 1 ? `Update ${index + 1}:` : 'Update:'}</h5>
								<div class="text-white/80 text-lg leading-relaxed">${content}</div>
							</div>
						`;
					});
					
					const changesContent = `<div class="space-y-4">${changes.join('')}</div>`;
						
					html += `
						<div class="changelog-entry">
							<div class="changelog-header flex justify-between items-center transition-colors duration-300">
								<div class="flex flex-col sm:flex-row sm:items-baseline">
									<span class="text-button-primary text-xl font-bold mr-4">${entry.version}</span>
								</div>
								<i class="fas fa-chevron-down text-xl text-link-primary transition-transform duration-300"></i>
							</div>
							
							<div class="changelog-content overflow-hidden" style="max-height: 0;">
								<div class="p-4 sm:p-6 pb-8">
									${changesContent}
								</div>
							</div>
						</div>
					`;
				});
				
				SELECTORS.contentChangelog.querySelector('#changelog-content').innerHTML = html;
				
				// Attach the new toggle function to the headers
				document.querySelectorAll('.changelog-header').forEach(header => {
					header.addEventListener('click', () => toggleChangelog(header));
				});
			};

			const toggleChangelog = (header) => {
				const entry = header.closest('.changelog-entry');
				const content = entry.querySelector('.changelog-content');
				const icon = header.querySelector('i');

				// Check if currently open
				const isOpen = content.classList.contains('open');

				// Close all other open entries for a clean look 
				document.querySelectorAll('.changelog-content.open').forEach(openContent => {
					if (openContent !== content) {
						openContent.style.maxHeight = '0';
						openContent.classList.remove('open');
						openContent.closest('.changelog-entry').querySelector('i').classList.remove('rotated');
					}
				});

				if (isOpen) {
					// CLOSE
					content.style.maxHeight = '0';
					content.classList.remove('open');
					icon.classList.remove('rotated');
				} else {
					// OPEN
					// Set max-height to the content's scroll height for a smooth animation
					content.style.maxHeight = content.scrollHeight + 50 + 'px'; // +50px buffer
					content.classList.add('open');
					icon.classList.add('rotated');
				}
			};

            const populateAboutSection = () => {
                // Tools
                let toolsHtml = GAME_DATA.tools.map(tool => `
                    <div class="p-4 rounded-xl card-glass border-subtle-accent">
                        <h4 class="text-xl font-bold text-link-primary flex justify-between items-start">
                            <span>${tool.name}</span>
                            <span class="text-button-primary font-semibold text-lg ml-4">${tool.price}</span>
                        </h4>
                        <p class="text-white/80 text-sm mt-2">${tool.description}</p>
                        <p class="text-white/60 text-xs mt-3"><i class="fas fa-hourglass-half mr-1"></i> Cooldown: ${tool.cooldown}</p>
                    </div>
                `).join('');
                SELECTORS.toolsContent.innerHTML = toolsHtml;

                // Mystery Box
                let mysteryHtml = '<div class="space-y-4">';
                GAME_DATA.mysteryBox.forEach(item => {
                    // Use border-subtle-accent by default
                    const rarityClass = item.rarity.includes('Super rare') ? 'ring-2 ring-link-primary/50' : 'border-subtle-accent';
                    mysteryHtml += `
                        <div class="p-4 rounded-xl card-glass ${rarityClass}">
                            <h4 class="text-lg font-bold text-link-primary flex justify-between items-center">
                                ${item.item} 
                                <span class="text-sm font-normal ${item.rarity.includes('Super rare') ? 'text-link-primary font-bold' : 'text-button-primary'}">[${item.rarity}]</span>
                            </h4>
                            <p class="text-white/80 text-sm mt-1">${item.howItWorks}</p>
                        </div>
                    `;
                });
                mysteryHtml += '</div>';
                SELECTORS.mysteryBoxContent.innerHTML = mysteryHtml;

                // Lucky Triples
                let triplesHtml = '<div class="space-y-4">';
                GAME_DATA.luckyTriples.forEach(item => {
                    triplesHtml += `
                        <div class="p-4 rounded-xl card-glass border-subtle-accent">
                            <h4 class="text-lg font-bold text-link-primary flex justify-between items-center">
                                ${item.item} 
                                <span class="text-sm font-normal text-button-primary">[${item.chance}]</span>
                            </h4>
                            <p class="text-white/80 text-sm mt-1">${item.howItWorks}</p>
                        </div>
                    `;
                });
                triplesHtml += '</div>';
                SELECTORS.luckyTriplesContent.innerHTML = triplesHtml;
            };

            const populateDatabaseSection = () => {
                // Modes
                let modesHtml = GAME_DATA.modes.map(mode => `
                    <div class="p-4 rounded-xl card-glass border-subtle-accent">
                        <h4 class="text-xl font-bold text-button-primary mb-2 flex items-center"><i class="${mode.icon} mr-3 text-link-primary"></i> ${mode.name} Mode</h4>
                        <p class="text-white/80 text-sm">${mode.description}</p>
                    </div>
                `).join('');
                SELECTORS.modesContent.innerHTML = modesHtml;

                // Difficulties
                let difficultiesHtml = GAME_DATA.difficulties.map(diff => `
                    <div class="p-4 rounded-xl card-glass border-subtle-accent">
                        <h4 class="text-xl font-bold text-button-primary mb-1">${diff.name}</h4>
                        <p class="text-white/80 text-sm"><span class="font-bold text-link-primary">Score to Win:</span> ${diff.score}</p>
                        <p class="text-white/80 text-sm">${diff.description}</p>
                    </div>
                `).join('');
                SELECTORS.difficultiesContent.innerHTML = difficultiesHtml;

                // Achievements
                let achievementsHtml = GAME_DATA.achievements.map(ach => `
                    <div class="p-4 rounded-xl card-glass border-subtle-accent flex flex-col">
                        <div class="flex items-center mb-2">
                            <i class="${ach.icon} text-link-primary mr-3 text-2xl flex-shrink-0"></i>
                            <h4 class="text-lg font-bold text-link-primary">${ach.name}</h4>
                        </div>
                        <p class="text-white/70 text-xs italic mb-2">${ach.subtitle}</p>
                        <p class="text-white/80 text-sm mt-auto">${ach.description}</p>
                    </div>
                `).join('');
                SELECTORS.achievementsContent.innerHTML = achievementsHtml;
            };
            
            // --- Routing Logic ---
            const switchSection = (sectionId) => {
                const sections = [SELECTORS.contentHome, SELECTORS.contentAbout, SELECTORS.contentChangelog, SELECTORS.contentDatabase];
                const activeSection = document.getElementById(`content-${sectionId}`);
                
                // Hide 404 page by default
                SELECTORS.content404.style.display = 'none';
                // Show main site elements
                SELECTORS.siteNav.classList.remove('hidden');
                SELECTORS.siteHeader.classList.remove('hidden');
                SELECTORS.mainPageWrapper.classList.remove('hidden');
                document.body.classList.remove('modal-open'); // Ensure scrolling is re-enabled if coming from 404

                // 1. Check for 404 condition
                if (!activeSection || !VALID_SECTIONS.includes(sectionId)) {
                    // 404 Triggered
                    SELECTORS.content404.style.display = 'flex';
                    // Hide all regular page elements
                    SELECTORS.siteNav.classList.add('hidden');
                    SELECTORS.siteHeader.classList.add('hidden');
                    SELECTORS.mainPageWrapper.classList.add('hidden');
                    document.body.classList.add('modal-open'); // Prevent scrolling on 404 page
                    
                    // Set the single Lottie file (no randomization)
                    SELECTORS.lottie404.src = LOTTIE_404_URL;
                    
                    // Update Document Title
                    SELECTORS.pageTitle.textContent = '404 - Page Not Found';

                    // Force the home link to point back home and handle routing
                    SELECTORS.homeLink404.onclick = (e) => {
                        e.preventDefault();
                        window.history.pushState(null, null, '#section=home');
                        handleRouting();
                    };
                    return;
                }


                // 2. Hide/Show Content Sections
                sections.forEach(sec => sec && sec.classList.add('hidden'));
                document.getElementById(`content-${sectionId}`).classList.remove('hidden');

                // 3. Update Navigation Links
                SELECTORS.navLinks.forEach(link => {
                    const linkSection = link.getAttribute('data-section');
                    const icon = link.querySelector('i');
                    if (linkSection === sectionId) {
                        link.classList.add('active');
                        if(icon) icon.classList.remove('text-link-primary');
                    } else {
                        link.classList.remove('active');
                        if(icon) icon.classList.add('text-link-primary');
                    }
                });

                // 4. Dynamic Hero Header Update (INSTANT CHANGE)
                const currentTitle = SECTION_TITLES[sectionId] || SECTION_TITLES['home'];
                
                // Set text content
                SELECTORS.heroTitle.textContent = currentTitle.title;
                SELECTORS.heroSubtitle.textContent = currentTitle.subtitle;

                // Adjust font size for non-home titles to be less prominent
                if (sectionId !== 'home') {
                    SELECTORS.heroTitle.classList.remove('text-7xl', 'sm:text-9xl');
                    SELECTORS.heroTitle.classList.add('text-5xl', 'sm:text-7xl');
                    SELECTORS.heroSubtitle.classList.remove('sm:text-3xl');
                    SELECTORS.heroSubtitle.classList.add('sm:text-2xl');
                } else {
                    SELECTORS.heroTitle.classList.remove('text-5xl', 'sm:text-7xl');
                    SELECTORS.heroTitle.classList.add('text-7xl', 'sm:text-9xl');
                    SELECTORS.heroSubtitle.classList.remove('sm:text-2xl');
                    SELECTORS.heroSubtitle.classList.add('sm:text-3xl');
                }
                
                // 5. Update Document Title
                SELECTORS.pageTitle.textContent = currentTitle.title + ' - Quiz for Survival';

                // 6. Close Burger Menu if open on mobile
                if (SELECTORS.navMenu && SELECTORS.navMenu.classList.contains('open') && window.innerWidth < 640) {
                    SELECTORS.navMenu.classList.remove('open');
                    SELECTORS.menuIcon.classList.remove('fa-times');
                    SELECTORS.menuIcon.classList.add('fa-bars');
                }
            };

            const startDownload = async (button, isWelcomeModal = false) => {
                const downloadUrl = SELECTORS.downloadButton.getAttribute('data-download-url'); 
                
                if (downloadUrl && !button.disabled) {
                    // Disable button
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Starting Download...';
                    
                    // IMPORTANT: Increment the download count before initiating the download
                    await incrementDownloadCount();

                    if (isWelcomeModal) hideWelcomeModal();

                    setTimeout(() => {
                        // Show modal and initiate download
                        const versionNumber = SELECTORS.versionDisplay.textContent || 'Unknown';
                        showDownloadModal(versionNumber);
                        window.location.href = downloadUrl;
                        
                        // Re-enable button after a short delay
                        setTimeout(() => {
                            button.disabled = false;
                            let newText = defaultButtonText;
                            if (button.id === 'welcome-download-button') {
                                newText = `<i class="fas fa-download mr-2"></i> Download ${versionNumber}`;
                            }
                            button.innerHTML = newText;
                        }, 1500);
                    }, 500);
                }
            };
            
            const handleRouting = () => {
                const hash = window.location.hash.substring(1); 
                const params = new URLSearchParams(hash);
                let section = params.get('section') || 'home';
                let action = params.get('action'); 
                
                // Determine if the action=download parameter is present in the URL
                const shouldAutoDownload = action === 'download' && SELECTORS.downloadButton.getAttribute('data-download-url');

                if (shouldAutoDownload) {
                    
                    // 1. Reset hash to remove action and prevent loop
                    const newHash = window.location.hash.split('&').filter(p => !p.includes('action=download')).join('&');
                    window.history.replaceState(null, null, newHash || '#section=home');

                    // 2. Start the download process (which includes the Firebase increment and showing the 'initiated' modal)
                    startDownload(SELECTORS.downloadButton); 
                }

                switchSection(section);

                // Scroll to top only if not viewing the 404 page
                if (window.innerWidth < 768 && section !== 'home' && VALID_SECTIONS.includes(section)) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };


            // --- Initialization ---
            const setupDownloadHandler = (versionNumber) => {
                SELECTORS.modalCloseButton.addEventListener('click', hideDownloadModal);

                // 1. Main Download Button on Home Page
                SELECTORS.downloadButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    startDownload(SELECTORS.downloadButton);
                });

                // 2. Download Button in Welcome Modal
                SELECTORS.welcomeDownloadButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    startDownload(SELECTORS.welcomeDownloadButton, true);
                });
                
                // 3. Continue Button in Welcome Modal
                SELECTORS.welcomeContinueButton.addEventListener('click', hideWelcomeModal);
            };

            const initializePage = async () => {
                
                // Initialize Firebase and start listening for downloads count immediately
                SELECTORS.downloadCountValue.textContent = 'Loading...';
                SELECTORS.fileSizeValue.textContent = HARDCODED_FILE_SIZE;
                
                // Start listener before fetching main data. It will update the hidden download-count-value
                await initializeFirebase();
                startDownloadListener();


                // Check the URL hash for action=download BEFORE any async operations
                const hash = window.location.hash.substring(1); 
                const params = new URLSearchParams(hash);
                const isAutoDownloadRequest = params.get('action') === 'download';


                // 1. Prepare other sections
                populateChangelogSection();
                populateAboutSection();
                populateDatabaseSection();

                // 2. Fetch data for the Home section (Latest Update)
                SELECTORS.downloadButton.disabled = true;
                const data = await fetchMasterData(URLS.masterData);
                
                let versionNumber = 'Unknown';

                // 3. Populate Home section and set up download logic
                if (data) {
                    populateHomePage(data);
                    const versionMatch = data.versionInfo.match(/Game:.*(v[\d.]+)/);
                    versionNumber = versionMatch ? versionMatch[1] : 'Unknown';
                    setupDownloadHandler(versionNumber);
                }

                // 4. Set up routing listeners and initial view
                window.addEventListener('hashchange', handleRouting);
                
                // Handle initial routing (will auto-download if isAutoDownloadRequest is true)
                handleRouting(); 

                
                // 5. Show Welcome Modal on load if data was successful AND not an auto-download request
                if (data && !isAutoDownloadRequest) {
                    await delay(300); 
                    showWelcomeModal(versionNumber);
                }

                // 6. Burger Menu Click Handler
                if (SELECTORS.menuButton) {
                    SELECTORS.menuButton.addEventListener('click', () => {
                        const isOpen = SELECTORS.navMenu.classList.toggle('open');
                        SELECTORS.menuIcon.classList.toggle('fa-bars', !isOpen);
                        SELECTORS.menuIcon.classList.toggle('fa-times', isOpen);
                    });
                }
            };

            initializePage();
        });
    </script>

</body>
</html>
